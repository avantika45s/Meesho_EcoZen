{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>EcoZen - Smart Finance Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'finovate-theme.css' %}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>
        /* Custom styles for index page */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0B1A33 0%, #162A4D 50%, #1E2A42 100%);
            min-height: 100vh;
        }
        
        header {
            background: linear-gradient(135deg, 
                rgba(15, 28, 77, 0.95) 0%, 
                rgba(30, 42, 66, 0.95) 100%);
            padding: 25px 0;
            text-align: center;
            border-bottom: 3px solid rgba(76, 175, 80, 0.4);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        header h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 10rem;
            font-weight: 900;
            background: linear-gradient(45deg, #FFA500, #FF6347, #FFD700, #FFA500);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 8px 0;
            text-shadow: 0 4px 20px rgba(255, 165, 0, 0.4);
            letter-spacing: 3px;
            animation: gradientShift 3s ease-in-out infinite;
            position: relative;
        }
        
        @keyframes gradientShift {
            0%, 100% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
        }

        header h1::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: linear-gradient(45deg, #FFA500, #FF6347);
            border-radius: 2px;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: translateX(-50%) scaleX(1);
            }
            50% {
                opacity: 0.7;
                transform: translateX(-50%) scaleX(1.2);
            }
        }

        header p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1rem;
            font-weight: 500;
            margin: 15px 0 0 0;
            letter-spacing: 0.5px;
        }
        
        main {
            padding: 30px 0;
        }
        
        .table-wrapper {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .table-title {
            background: linear-gradient(135deg, 
                rgba(15, 28, 77, 0.8) 0%, 
                rgba(30, 42, 66, 0.8) 100%);
            border-radius: 16px 16px 0 0;
            padding: 25px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-bottom: none;
        }
        
        .table-title .row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            align-items: center;
        }
        
        .table-title .btn {
            background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
            color: #000000 !important; /* Black text */
            border: none;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            font-size: 13px; /* Reduced font size */
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            display: inline-flex;
            align-items: center;
            gap: 1px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            position: relative;
            overflow: hidden;
            white-space: nowrap; /* Prevent text wrapping */
        }
        
        .table-title .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .table-title .btn:hover::before {
            left: 100%;
        }
        
        .table-title .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
            color: #000000 !important; /* Keep black text on hover */
            text-decoration: none;
        }
        
        .table-title .btn i {
            font-size: 14px;
        }
        
        /* Special styling for different button types */
        .table-title .btn:nth-child(odd) {
            background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        
        .table-title .btn:nth-child(odd):hover {
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .modal-footer .btn {
            background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
            color: white !important;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        .modal-footer .btn-default {
            background: linear-gradient(135deg, #666 0%, #888 100%);
            box-shadow: 0 2px 8px rgba(102, 102, 102, 0.3);
        }

        .modal-footer .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #ff6b6b 100%);
            box-shadow: 0 2px 8px rgba(244, 67, 54, 0.3);
        }

        .modal-footer .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        .modal-footer .btn-default:hover {
            box-shadow: 0 4px 15px rgba(102, 102, 102, 0.4);
        }

        .modal-footer .btn-danger:hover {
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.4);
        }

        .table .edit, .table .delete {
            color: #4caf50;
            margin: 0 4px;
            font-size: 18px;
            transition: all 0.3s ease;
            padding: 8px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            cursor: pointer;
        }

        .table .edit:hover {
            color: #ffffff;
            background: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%);
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
            transform: scale(1.1);
            text-decoration: none;
        }

        .table .delete:hover {
            color: #ffffff;
            background: linear-gradient(135deg, #f44336 0%, #ff6b6b 100%);
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.4);
            transform: scale(1.1);
            text-decoration: none;
        }
        
        .table {
            background: rgba(15, 28, 77, 0.8);
            backdrop-filter: blur(15px);
            border-radius: 0 0 16px 16px;
            overflow: hidden;
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-top: none;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .table thead th {
            background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
            color: #ffffff;
            padding: 18px 16px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            font-size: 13px;
            border: none;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .table tbody td {
            padding: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: #ffffff !important; /* White text for all rows */
            font-weight: 500;
            vertical-align: middle;
        }
        
        .table tbody tr {
            background: rgba(30, 42, 66, 0.8) !important; /* Blue background for all rows */
        }
        
        .table tbody tr:hover {
            background: rgba(76, 175, 80, 0.15) !important;
            transform: scale(1.01);
            transition: all 0.3s ease;
        }
        
        .table tbody tr:last-child td {
            border-bottom: none;
        }
        
        /* Action buttons in table */
        .table .edit, .table .delete {
            color: #4caf50;
            margin: 0 4px;
            font-size: 18px;
            transition: all 0.3s ease;
            padding: 6px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .table .edit:hover {
            color: #ffffff;
            background: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%);
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
            transform: scale(1.1);
        }
        
        .table .delete:hover {
            color: #ffffff;
            background: linear-gradient(135deg, #f44336 0%, #ff6b6b 100%);
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.4);
            transform: scale(1.1);
        }
        
        /* Modal styling updates */
        .modal-content {
            background: linear-gradient(135deg, 
                rgba(15, 28, 77, 0.95) 0%, 
                rgba(30, 42, 66, 0.95) 100%);
            border-radius: 16px;
            border: 2px solid rgba(76, 175, 80, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
        }
        
        .modal-header {
            background: linear-gradient(135deg, #1E2A42 0%, #2C3A5A 100%);
            border-radius: 14px 14px 0 0;
            border-bottom: 2px solid rgba(76, 175, 80, 0.3);
            padding: 20px 25px;
        }
        
        .modal-title {
            color: #FFA500;
            font-weight: 700;
            font-size: 1.4rem;
            text-shadow: 0 2px 10px rgba(255, 165, 0, 0.3);
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .modal-footer {
            background: rgba(30, 42, 66, 0.8);
            border-radius: 0 0 14px 14px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px 25px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        /* Floating chat button */
        .open-chat-button {
            background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
            color: white;
            padding: 0;
            border: none;
            cursor: pointer;
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            z-index: 9999;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .modal .form-control,
        .modal .custom-select {
            color: #fff !important;
            background: rgba(255, 255, 255, 0.1) !important;
            border: 2px solid rgba(76, 175, 80, 0.3) !important;
            border-radius: 12px;
            padding: 16px 20px;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .modal .form-control:focus,
        .modal .custom-select:focus {
            outline: none;
            border-color: #4caf50 !important;
            background: rgba(255, 255, 255, 0.15) !important;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.3) !important;
            color: #fff !important;
        }
        
        .modal .form-control::placeholder,
        .modal .custom-select::placeholder,
        .modal select.form-control option {
            color: rgba(255, 255, 255, 0.6) !important;
            font-weight: 400;
        }
        
        .modal select.form-control {
            color: #fff !important;
            background: rgba(255, 255, 255, 0.1) !important;
        }
        
        .modal select.form-control option {
            background: rgba(15, 28, 77, 0.95);
            color: #fff;
        }

        .modal select.form-control option:checked,
        .modal select.form-control option:selected,
        .modal select.custom-select option:checked,
        .modal select.custom-select option:selected,
        .modal .form-control.custom-select option:checked,
        .modal .form-control.custom-select option:selected {
            background: rgba(76, 175, 80, 0.3);
            color: #fff !important;
        }
        
        /* Ensure dropdown shows selected value */
        .modal select.form-control:focus {
            color: #fff !important;
            background: rgba(255, 255, 255, 0.15) !important;
        }
        
        /* For webkit browsers */
        .modal select.form-control option:hover {
            background: rgba(76, 175, 80, 0.2);
            color: #fff;
        }
        .modal select.form-control option[disabled] {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        /* un-chosen (invalid) state */
        .modal select.form-control:invalid {
            color: rgba(255, 255, 255, 0.6) !important;
            border-color: rgba(76, 175, 80, 0.3) !important;
        }

        /* once a valid option is picked */
        .modal select.form-control:valid {
            color: #fff !important;
            border-color: #4caf50 !important;
        }

        /* ensure the chosen option text itself is white */
        .modal select.form-control option:checked,
        .modal select.form-control option[selected] {
            color: #fff !important;
            background: rgba(30, 42, 66, 0.95) !important;
        }
        
        .open-chat-button:hover {
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 12px 30px rgba(76, 175, 80, 0.5);
        }
        
        .video-container {
            width: 100%;
            height: 100%;
            position: relative;
            border-radius: 50%;
            overflow: hidden;
        }
        
        .video-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Chat conversation styling */
        #conversation {
            position: fixed;
            bottom: 100px;
            right: 25px;
            width: 350px;
            max-height: 500px;
            background: linear-gradient(135deg, 
                rgba(15, 28, 77, 0.95) 0%, 
                rgba(30, 42, 66, 0.95) 100%);
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            z-index: 9998;
            display: none;
        }
        
        .user-messages {
            background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
            color: white;
            padding: 12px 16px;
            margin: 8px;
            border-radius: 12px 12px 4px 12px;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }
        
        .chatbot-messages {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
            padding: 12px 16px;
            margin: 8px;
            border-radius: 12px 12px 12px 4px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .centered-textarea {
            width: 100%;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 8px;
            color: white;
            padding: 8px 12px;
            font-family: inherit;
            resize: none;
        }
        
        .centered-textarea:focus {
            outline: none;
            border-color: #4caf50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.3);
        }
        
        .send-container {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
        }
        
        /* No data message */
        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .no-data i {
            font-size: 4rem;
            color: #ff9800;
            margin-bottom: 20px;
        }
        
        .no-data h3 {
            color: #FFA500;
            margin-bottom: 15px;
        }
        
        .no-data p {
            font-size: 1.1rem;
            margin-bottom: 25px;
        }
        @media (min-width: 768px) {
            .col-sm-offset-1 {
                margin-left: 1%;
            }
        }
        /* Responsive design */
        @media (max-width: 768px) {
            header h1 {
                font-size: 2.5rem;
            }
            
            .table-title .row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .table-title .btn {
                justify-content: center;
                margin: 4px 0;
                font-size: 10px;
                padding: 6px 8px;
            }
            
            .table {
                font-size: 13px;
            }
            
            .table thead th,
            .table tbody td {
                padding: 12px 8px;
            }
            
            #conversation {
                width: calc(100vw - 40px);
                right: 20px;
                left: 20px;
            }
        }
        
        /* Loading states */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(11, 26, 51, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }
        
        .loading-content {
            text-align: center;
            color: white;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(76, 175, 80, 0.2);
            border-radius: 50%;
            border-left-color: #4caf50;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    
</head>
<body>
    <header>
        <h1>EcoZen</h1>
        <p style="color:white">Your financial peace of mind.....</p>
        {% comment %} <label class="switch">
            <input type="checkbox" id="darkModeToggle">
            <span class="slider round"></span>
        </label> {% endcomment %}
        {% comment %} <div class="user-info">
            {% if user.is_authenticated %}
                <p>Welcome, {{ user.username }}!</p>
                <p>User ID: {{getCookie}}</p>
            {% else %}
                <p>Welcome, Guest!</p>
                <!-- Handle guest users here -->
            {% endif %}
        </div> {% endcomment %}
    </header>
    <main>

    <div class="table-wrapper">
        <div class="table-title">
            <div class="row">
                <div class="col-sm-offset-1">
                    <a href="/signup/" class="btn"><i class="material-icons">&#xE8B8;</i><span>SignUp</span></a>
                    <a href="#addExpenseModal" class="btn" data-toggle="modal"><i class="material-icons">&#xE147;</i>
                        <span>Add New Expense</span></a>
                    <a href="/summary" class="btn"><i class="material-icons">&#xE8B8;</i><span>Show Expense Summary</span></a>
                    <a href="#getUserStatus" class="btn" data-toggle="modal"><i class="material-icons">&#xE147;</i>
                        <span>Add/Update Personal Data</span></a>
                        <a href="/comparepredict" class="btn" data-toggle="modal"><i class="material-icons">&#xE8B8;</i>
                            <span>Price Comparison</span></a>
                    <a href="mail_expense/" class="btn"><i class="material-icons">&#xE8B8;</i><span>E-Mail Expenses</span></a>
                    <!-- <a href="/popup/" id="eco-score-btn" class="btn"><i class="material-icons">&#xE8B8;</i><span>Eco Score</span></a> -->
                  
                </div>
            </div>
            <table class="table table-striped table-hover">

                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Amount</th>
                        <th>Category</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>

                <tbody>
                    {% if expenses %}
                    {% for expense in expenses %}
                    <tr>
                        <td>{{ expense.item.capitalize }}</td>
                        <td>{{ expense.amount }}</td>
                        <td>{{ expense.category.capitalize }}</td>
                        <td>{{ expense.date }}</td>
                        <td>
                           <a href="#" class="edit" data-toggle="modal" data-target="#editModal{{ expense.id }}">
        <i class="material-icons" title="Edit">&#xE254;</i>
      </a>
      <a href="#" class="delete" data-toggle="modal" data-target="#deleteModal{{ expense.id }}">
        <i class="material-icons" title="Delete">&#xE872;</i>
      </a>
                            
                    {% endfor %}
                    {% endif %}
                </tbody>

            </table>
        </div>
        {% for expense in expenses %}
  <!-- Edit Modal -->
  <div id="editModal{{ expense.id }}" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <form method="post" action="./update/{{ expense.id }}">
          {% csrf_token %}
          <div class="modal-header">
            <h4 class="modal-title">Edit Expense</h4>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="item{{ expense.id }}">Item</label>
              <input id="item{{ expense.id }}" class="form-control" type="text" name="item"
                     value="{{ expense.item }}" required>
            </div>
            <div class="form-group">
              <label for="amount{{ expense.id }}">Amount</label>
              <input id="amount{{ expense.id }}" class="form-control" type="number" step="0.01"
                     name="amount" value="{{ expense.amount }}" required>
            </div>
            <div class="form-group">
              <label for="category{{ expense.id }}">Category</label>
              <select id="category{{ expense.id }}" class="form-control" name="category" required>
  <option value="food"       {% if expense.category == 'food'       %}selected{% endif %}>Food</option>
  <option value="clothes"    {% if expense.category == 'clothes'    %}selected{% endif %}>Clothes</option>
  <option value="travel"     {% if expense.category == 'travel'     %}selected{% endif %}>Travel</option>
  <option value="electronics"{% if expense.category == 'electronics'%}selected{% endif %}>Electronics</option>
  <option value="books"      {% if expense.category == 'books'      %}selected{% endif %}>Books</option>
  <option value="stationery" {% if expense.category == 'stationery' %}selected{% endif %}>Stationery</option>
</select>
            </div>
            <div class="form-group">
              <label for="date{{ expense.id }}">Date</label>
              <input id="date{{ expense.id }}" class="form-control" type="date" name="date"
                     value="{{ expense.date|date:'Y-m-d' }}" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-info">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Delete Modal -->
  <div id="deleteModal{{ expense.id }}" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <form method="post" action="./delete/{{ expense.id }}">
          {% csrf_token %}
          <div class="modal-header">
            <h4 class="modal-title">Delete Expense</h4>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>
          <div class="modal-body">
            <p>Are you sure you want to delete “{{ expense.item }}”?</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-danger">Delete</button>
          </div>
        </form>
      </div>
    </div>
  </div>
{% endfor %}
        <button class="open-chat-button" onclick="openForm()">
            <div class="video-container">
                <video autoplay loop muted>
                    <source src="{% static 'globe.mp4' %}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                {% comment %} <div class="video-overlay">
                    Chat
                </div> {% endcomment %}
            </div>
        </button>
        <!-- Add this complete chat popup to your index.html template -->
<div class="chat-popup" id="myForm" style="display: none;">
    <div style="background: linear-gradient(135deg, #1E2A42 0%, #2C3A5A 100%); padding: 20px; border-radius: 16px 16px 0 0; border-bottom: 2px solid rgba(76, 175, 80, 0.3);">
        <h3 style="color: #FFA500; margin: 0; font-weight: 700;">EcoZen AI Assistant</h3>
        <button type="button" onclick="closeForm()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; color: #FFA500; font-size: 20px; cursor: pointer;">&times;</button>
    </div>
    
    <div id="conversation" style="max-height: 300px; overflow-y: auto; padding: 15px; background: rgba(30, 42, 66, 0.8);">
        {% for message in conversation %}
            {% if message.role == 'user' %}
                <div class="user-messages" style="background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%); color: white; padding: 12px 16px; margin: 8px 0; border-radius: 12px 12px 4px 12px; font-weight: 500;">
                    <strong>You:</strong> {{ message.content }}
                </div>
            {% elif message.role == 'assistant' %}
                <div class="chatbot-messages" style="background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.9); padding: 12px 16px; margin: 8px 0; border-radius: 12px 12px 12px 4px; border: 1px solid rgba(255, 255, 255, 0.2);">
                    <strong>EcoZen AI:</strong> {{ message.content }}
                </div>
            {% endif %}
        {% endfor %}
    </div>
    
    <div class="send-container" style="padding: 15px; background: rgba(30, 42, 66, 0.8); border-radius: 0 0 16px 16px;">
        <form id="chat-form" method="POST" action="{% url 'chatbot' %}" style="display: flex; gap: 10px; align-items: center;">
            {% csrf_token %}
            <textarea 
                id="userInput" 
                name="user_input"
                class="centered-textarea" 
                placeholder="Ask me about your expenses, savings, or financial advice..."
                style="flex: 1; min-height: 40px; max-height: 100px; resize: vertical; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(76, 175, 80, 0.3); border-radius: 8px; color: white; padding: 8px 12px; font-family: inherit;"
                required
            ></textarea>
            <button type="submit" style="background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                Send
            </button>
        </form>
    </div>
</div>

    </main>
    {% comment %} Modals {% endcomment %}
    <!-- Add Modal HTML -->
    <div id="addExpenseModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="./add">
                    {% csrf_token %}
                    <div class="modal-header">
                        <h4 class="modal-title">Add Expense</h4>
                        <button type="button" class="btn-close close" data-dismiss="modal" aria-hidden="true">&times;
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Item</label>
                            <input class="form-control" type="text" name="item" placeholder="Enter the item" required>
                        </div>
                        <div class="form-group">
                            <label>Amount</label>
                            <input class="form-control" type="text" name="amount" placeholder="Enter the amount"
                                required>
                        </div>
                        <div class="form-group">
                            <label>Category</label>
                            <select class="form-control" name="category" required>
                                <option value="" selected disabled hidden>Choose the category</option>
                                <option value="food" name="category">Food</option>
                                <option value="clothes" name="category">Clothes</option>
                                <option value="travel" name="category">Travel</option>
                                <option value="electronics" name="category">Electronics</option>
                                <option value="books" name="category">Books</option>
                                <option value="stationery" name="category">Stationery</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" class="form-control" name="date">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                        <input type="submit" class="btn btn-success" value="Add Expense">
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- getUserStatus Modal HTML -->
    <div id="getUserStatus" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="{% url 'add_user_status' %}" class="form-container">
                    {% csrf_token %}
                    <div class="modal-header">
                        <h4 class="modal-title">Add User Status</h4>
                        <button type="button" class="btn-close close" data-dismiss="modal"
                            aria-hidden="true">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Allowed Expense</label>
                            <input class="form-control" type="number" name="allowedexpense"
                                placeholder="Enter allowed expense" required>
                        </div>
                        <div class="form-group">
                            <label>Monthly Budget</label>
                            <input class="form-control" type="number" name="monthlybudget"
                                placeholder="Enter monthly budget" required>
                        </div>
                        <div class="form-group">
                            <label>Pincode</label>
                            <input class="form-control" type="number" name="pincode" placeholder="Enter pincode"
                                required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                        <input type="submit" class="btn btn-success" value="Save User Status">
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatForm = document.getElementById('chat-form');
            const userInput = document.getElementById('user-input');
            const conversation = document.getElementById('conversation');

            // Scroll conversation to the bottom
            conversation.scrollTop = conversation.scrollHeight;

            // Submit the form when the user presses Enter key
            userInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    chatForm.submit();
                }
            });

            // Focus on the user input field
            userInput.focus();
        });
        document.addEventListener('DOMContentLoaded', () => {
            const chatPopup = document.getElementById('myForm');

            // Check if the current URL contains "/chatbot"
            const isChatbotPage = window.location.pathname.includes('/chatbot');

            // Set the display style of the chat popup accordingly
            if (isChatbotPage) {
                chatPopup.style.display = 'block';
            } else {
                chatPopup.style.display = 'none';
            }
        });
        function getCookie(cookieName) {
            // Split all cookies into an array
            var cookies = document.cookie.split(';');
            
            // Iterate through each cookie
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                
                // Check if the cookie starts with the provided name
                if (cookie.startsWith(cookieName + '=')) {
                    // Extract and return the cookie value
                    return decodeURIComponent(cookie.substring(cookieName.length + 1));
                }
            }
            
            // Return null if the cookie with the given name is not found
            return null;
        }

        function openForm() {
            document.getElementById("myForm").style.display = "block";
        }

        function closeForm() {
            document.getElementById("myForm").style.display = "none";
            history.pushState(null, '', '');
        }

         // Function to fetch user information
        function fetchUserInfo() {
            // Make an AJAX request to your backend to fetch user information
            // Replace 'api/user/info' with your actual endpoint
            fetch('/api/user/info')
                .then(response => response.json())
                .then(data => {
                    // Update the DOM with user information
                    document.getElementById('user-info').innerHTML = `Welcome, ${data.username}! User ID: ${data.user_id}`;
                })
                .catch(error => console.error('Error fetching user information:', error));
        }
        // Call fetchUserInfo() when the page loads
        window.onload = fetchUserInfo;
        
    </script>

    <script src="script.js"></script>
<script>
$(function(){
    $('[data-toggle="tooltip"]').tooltip();
  });
</script>

<script>
        let chatFormVisible = false;

        function openForm() {
            const chatForm = document.getElementById('myForm');
            const userInput = document.getElementById('userInput');
            
            if (chatForm) {
                chatFormVisible = !chatFormVisible;
                chatForm.style.display = chatFormVisible ? 'block' : 'none';
                
                if (chatFormVisible && userInput) {
                    setTimeout(() => userInput.focus(), 100);
                }
            }
        }

        function closeForm() {
            const chatForm = document.getElementById('myForm');
            if (chatForm) {
                chatForm.style.display = 'none';
                chatFormVisible = false;
            }
        }

        // Handle form submission
        document.addEventListener('DOMContentLoaded', function() {
            const chatForm = document.getElementById('chat-form');
            const userInput = document.getElementById('userInput');
            const conversation = document.getElementById('conversation');

            if (chatForm) {
                chatForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const userMessage = userInput.value.trim();
                    if (!userMessage) return;

                    // Add user message to conversation immediately
                    addMessageToConversation('user', userMessage);
                    
                    // Clear input
                    userInput.value = '';
                    
                    // Show loading message
                    const loadingId = addMessageToConversation('assistant', 'Thinking...');
                    
                    // Submit form data
                    const formData = new FormData(chatForm);
                    
                    fetch(chatForm.action, {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest',
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        // Remove loading message
                        const loadingMsg = document.getElementById(loadingId);
                        if (loadingMsg) loadingMsg.remove();
                        
                        if (data.success) {
                            addMessageToConversation('assistant', data.response);
                        } else {
                            addMessageToConversation('assistant', 'Sorry, I encountered an error. Please try again.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        // Remove loading message
                        const loadingMsg = document.getElementById(loadingId);
                        if (loadingMsg) loadingMsg.remove();
                        
                        addMessageToConversation('assistant', 'Sorry, I encountered an error. Please try again.');
                    });
                });
            }

            // Allow Enter to submit (with Shift+Enter for new line)
            if (userInput) {
                userInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        chatForm.dispatchEvent(new Event('submit'));
                    }
                });
            }
        });

         function addMessageToConversation(role, message) {
            const conversation = document.getElementById('conversation');
            const messageId = 'msg-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            
            const messageDiv = document.createElement('div');
            messageDiv.id = messageId;
            
            if (role === 'user') {
                messageDiv.className = 'user-messages';
                messageDiv.style.cssText = 'background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%); color: white; padding: 12px 16px; margin: 8px 0; border-radius: 12px 12px 4px 12px; font-weight: 500;';
                messageDiv.innerHTML = '<strong>You:</strong> ' + escapeHtml(message);
            } else {
                messageDiv.className = 'chatbot-messages';
                messageDiv.style.cssText = 'background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.9); padding: 12px 16px; margin: 8px 0; border-radius: 12px 12px 12px 4px; border: 1px solid rgba(255, 255, 255, 0.2);';
                messageDiv.innerHTML = '<strong>EcoZen AI:</strong> ' + escapeHtml(message);
            }
            
            conversation.appendChild(messageDiv);
            conversation.scrollTop = conversation.scrollHeight;
            
            return messageId;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Auto-scroll to bottom when new messages are added
        const observer = new MutationObserver(function() {
            const conversation = document.getElementById('conversation');
            if (conversation) {
                conversation.scrollTop = conversation.scrollHeight;
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const conversation = document.getElementById('conversation');
            if (conversation) {
                observer.observe(conversation, { childList: true });
            }
        });
    </script>
</body>

</html>